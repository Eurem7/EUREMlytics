<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Oxdemi — Quality Report</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:        #f5f5f3;
      --bg2:       #efefec;
      --surface:   #ffffff;
      --surface2:  #fafaf8;
      --border:    rgba(0,0,0,0.08);
      --border2:   rgba(0,0,0,0.14);
      --text:      #0f0f0e;
      --text2:     #555550;
      --text3:     #8c8c86;
      --accent:    #1a6bff;
      --green:     #00875a;
      --green-bg:  #f0faf5;
      --warn:      #b45309;
      --warn-bg:   #fefce8;
      --red:       #c0392b;
      --red-bg:    #fff5f5;
      --purple:    #6d28d9;
      --mono:      'JetBrains Mono', monospace;
      --sans:      'DM Sans', sans-serif;
      --r:         6px;
      --r2:        10px;
      --sh:        0 1px 2px rgba(0,0,0,0.06), 0 2px 8px rgba(0,0,0,0.04);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      font-size: 14px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 10px; }

    /* Header */
    header {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border2);
      padding: 0 2.5rem;
      height: 52px;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .logo-mark {
      width: 36px; height: 26px;
      background: var(--text);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-size: 0.55rem; font-weight: 700;
      color: #fff; letter-spacing: 0.5px;
    }
    .logo-text {
      font-size: 0.88rem; font-weight: 600; letter-spacing: -0.01em;
    }
    .logo-text span { color: var(--text3); font-weight: 400; }
    .hdr-divider { width: 1px; height: 20px; background: var(--border2); }
    .hdr-label { font-family: var(--mono); font-size: 0.68rem; color: var(--text3); }
    .hdr-meta {
      margin-left: auto;
      font-family: var(--mono); font-size: 0.65rem; color: var(--text3);
      background: var(--bg2); border: 1px solid var(--border2);
      padding: 0.2rem 0.65rem; border-radius: 4px;
    }

    /* Layout */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 2.5rem 2rem;
      display: grid;
      gap: 2.5rem;
    }

    /* Section */
    .section-head {
      display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;
    }
    .section-hed {
      font-size: 0.68rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.1em; color: var(--text3); white-space: nowrap;
    }
    .section-rule { flex: 1; height: 1px; background: var(--border2); }
    .section-count { font-family: var(--mono); font-size: 0.65rem; color: var(--text3); white-space: nowrap; }

    /* Stat strip */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1px; background: var(--border2);
      border: 1px solid var(--border2);
      border-radius: var(--r2); overflow: hidden; box-shadow: var(--sh);
    }
    .stat-card { background: var(--surface); padding: 1.25rem 1.5rem; }
    .stat-card .value {
      font-family: var(--mono); font-size: 1.8rem; font-weight: 600;
      color: var(--text); line-height: 1; letter-spacing: -0.03em;
    }
    .stat-card .value.blue   { color: var(--accent); }
    .stat-card .value.green  { color: var(--green); }
    .stat-card .value.purple { color: var(--purple); }
    .stat-card .label {
      font-size: 0.67rem; color: var(--text3); margin-top: 0.4rem;
      text-transform: uppercase; letter-spacing: 0.08em; font-weight: 600;
    }

    /* Tables */
    .table-wrap {
      background: var(--surface); border: 1px solid var(--border2);
      border-radius: var(--r2); overflow: hidden; overflow-x: auto; box-shadow: var(--sh);
    }
    table { width: 100%; border-collapse: collapse; font-size: 0.78rem; }
    th {
      background: var(--bg); color: var(--text3); font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em; font-size: 0.62rem;
      padding: 0.6rem 1rem; text-align: left;
      border-bottom: 1px solid var(--border2); white-space: nowrap;
    }
    td { padding: 0.6rem 1rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: var(--surface2); }
    .td-mono { font-family: var(--mono); font-size: 0.72rem; font-weight: 500; }
    .td-dim  { color: var(--text3); font-family: var(--mono); font-size: 0.7rem; }

    /* Badges */
    .badge {
      display: inline-flex; align-items: center;
      padding: 0.15rem 0.55rem; border-radius: 4px;
      font-size: 0.6rem; font-weight: 700; letter-spacing: 0.06em;
      font-family: var(--mono); text-transform: uppercase;
    }
    .badge.good { background: var(--green-bg); color: var(--green); border: 1px solid rgba(0,135,90,0.15); }
    .badge.warn { background: var(--warn-bg);  color: var(--warn);  border: 1px solid rgba(180,83,9,0.15); }
    .badge.bad  { background: var(--red-bg);   color: var(--red);   border: 1px solid rgba(192,57,43,0.15); }
    .badge.type { background: var(--bg2); color: var(--text3); border: 1px solid var(--border2); }

    /* Score bar */
    .sbar-wrap { display: flex; align-items: center; gap: 0.6rem; }
    .sbar { flex: 1; height: 4px; background: var(--bg2); border-radius: 2px; overflow: hidden; min-width: 60px; }
    .sbar-fill { height: 100%; border-radius: 2px; }
    .sbar-fill.good { background: var(--green); }
    .sbar-fill.warn { background: var(--warn); }
    .sbar-fill.bad  { background: var(--red); }
    .sbar-num { font-family: var(--mono); font-size: 0.65rem; color: var(--text3); min-width: 28px; text-align: right; }

    /* Missing bar */
    .missing-bar-wrap {
      height: 4px; background: var(--bg2); border-radius: 2px;
      overflow: hidden; width: 100px; display: inline-block; vertical-align: middle;
    }
    .missing-bar { height: 100%; background: var(--warn); border-radius: 2px; }

    /* Audit log */
    .log-list {
      background: var(--surface); border: 1px solid var(--border2);
      border-radius: var(--r2); overflow: hidden;
      max-height: 380px; overflow-y: auto; box-shadow: var(--sh);
    }
    .log-head {
      display: grid; grid-template-columns: 64px 210px 1fr;
      background: var(--bg); border-bottom: 1px solid var(--border2);
    }
    .log-hcell {
      padding: 0.5rem 0.85rem; font-size: 0.6rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: 0.08em; color: var(--text3);
      border-right: 1px solid var(--border);
    }
    .log-hcell:last-child { border-right: none; }
    .log-entry {
      display: grid; grid-template-columns: 64px 210px 1fr;
      border-bottom: 1px solid var(--border);
      font-family: var(--mono); font-size: 0.7rem;
    }
    .log-entry:last-child { border-bottom: none; }
    .log-entry:hover { background: var(--surface2); }
    .log-cell {
      padding: 0.5rem 0.85rem; display: flex; align-items: center;
      border-right: 1px solid var(--border); gap: 0.4rem;
    }
    .log-cell:last-child { border-right: none; }
    .log-ts { color: var(--text3); font-size: 0.62rem; }
    .log-action { font-weight: 600; font-size: 0.68rem; }
    .log-action.drop     { color: var(--red); }
    .log-action.impute   { color: var(--warn); }
    .log-action.outlier  { color: var(--purple); }
    .log-action.pipeline { color: var(--green); }
    .log-action.id       { color: var(--accent); }
    .log-col  { color: var(--text3); font-size: 0.62rem; }
    .log-detail { color: var(--text2); flex-wrap: wrap; gap: 0.5rem; display: flex; font-size: 0.65rem; }
    .kv { display: inline-flex; gap: 0.25rem; }
    .kv-k { color: var(--text3); }
    .kv-v { color: var(--text); }

    /* Correlation */
    .corr-cell { text-align: center; font-family: var(--mono); font-size: 0.7rem; }
    .corr-high-pos { color: var(--green); font-weight: 600; }
    .corr-high-neg { color: var(--red); font-weight: 600; }
    .corr-diag     { color: var(--text3); }

    /* Preview table */
    .preview-table th { background: var(--bg2); font-size: 0.6rem; }
    .preview-table td { font-family: var(--mono); font-size: 0.7rem; color: var(--text2); }

    /* Footer */
    footer {
      border-top: 1px solid var(--border2);
      padding: 1.5rem 2rem;
      text-align: center;
      font-size: 0.72rem;
      color: var(--text3);
      font-family: var(--mono);
    }
    footer strong { color: var(--text); }

    @media (max-width: 640px) {
      header { padding: 0 1rem; }
      main { padding: 1.5rem 1rem; }
      .log-head, .log-entry { grid-template-columns: 1fr; }
      .log-hcell, .log-cell { border-right: none; border-bottom: 1px solid var(--border); }
      .log-hcell:last-child, .log-cell:last-child { border-bottom: none; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo-mark">OXD</div>
  <span class="logo-text">Oxdemi<span>.io</span></span>
  <div class="hdr-divider"></div>
  <span class="hdr-label">Quality Report</span>
  <span class="hdr-meta">{{ shape[0] }} rows · {{ shape[1] }} columns</span>
</header>

<main>

  <!-- Overview -->
  <section>
    <div class="section-head">
      <span class="section-hed">Overview</span>
      <span class="section-rule"></span>
    </div>
    <div class="stats-row">
      <div class="stat-card">
        <div class="value blue">{{ shape[0] }}</div>
        <div class="label">Total Rows</div>
      </div>
      <div class="stat-card">
        <div class="value">{{ shape[1] }}</div>
        <div class="label">Columns</div>
      </div>
      <div class="stat-card">
        <div class="value green">{{ column_quality | selectattr("css_class", "equalto", "good") | list | length }}</div>
        <div class="label">High Quality</div>
      </div>
      <div class="stat-card">
        <div class="value">{{ missing_values | length }}</div>
        <div class="label">Cols w/ Missing</div>
      </div>
      <div class="stat-card">
        <div class="value purple">{{ audit_log | length }}</div>
        <div class="label">Actions Taken</div>
      </div>
    </div>
  </section>

  <!-- Column Quality -->
  <section>
    <div class="section-head">
      <span class="section-hed">Column Quality</span>
      <span class="section-rule"></span>
      <span class="section-count">{{ column_quality | length }} columns</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Column</th>
            <th>Type</th>
            <th style="min-width:160px">Quality Score</th>
            <th>Missing</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for col in column_quality %}
          <tr>
            <td class="td-mono">{{ col.column }}</td>
            <td><span class="badge type">{{ col.type }}</span></td>
            <td>
              <div class="sbar-wrap">
                <div class="sbar">
                  <div class="sbar-fill {{ col.css_class }}" style="width:{{ (col.quality_score * 100) | round }}%"></div>
                </div>
                <span class="sbar-num">{{ col.quality_score }}</span>
              </div>
            </td>
            <td class="td-dim">{% if col.missing_pct is not none %}{{ col.missing_pct }}%{% else %}—{% endif %}</td>
            <td><span class="badge {{ col.css_class }}">{{ col.css_class.upper() }}</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Missing Values -->
  {% if missing_values %}
  <section>
    <div class="section-head">
      <span class="section-hed">Missing Values</span>
      <span class="section-rule"></span>
      <span class="section-count">{{ missing_values | length }} columns affected</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr><th>Column</th><th>Missing Count</th><th>Percentage</th><th>Distribution</th></tr>
        </thead>
        <tbody>
          {% for m in missing_values %}
          <tr>
            <td class="td-mono">{{ m.column }}</td>
            <td class="td-dim">{{ m.count }}</td>
            <td class="td-dim">{{ ((m.count / shape[0]) * 100) | round(1) }}%</td>
            <td>
              <div class="missing-bar-wrap">
                <div class="missing-bar" style="width: {{ [m.count / shape[0] * 100, 100] | min }}%"></div>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  {% endif %}

  <!-- Data Preview -->
  <section>
    <div class="section-head">
      <span class="section-hed">Data Preview</span>
      <span class="section-rule"></span>
      <span class="section-count">first 10 rows</span>
    </div>
    <div class="table-wrap preview-table">
      {{ preview_html | safe }}
    </div>
  </section>

  <!-- Correlation Matrix -->
  {% if corr_columns %}
  <section>
    <div class="section-head">
      <span class="section-hed">Correlation Matrix</span>
      <span class="section-rule"></span>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th></th>
            {% for c in corr_columns %}<th>{{ c }}</th>{% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in corr_rows %}
          <tr>
            <td class="td-mono">{{ row.label }}</td>
            {% for c in corr_columns %}
            {% set val = row[c] %}
            <td class="corr-cell
              {% if val == 1.0 %} corr-diag
              {% elif val is number and val > 0.7 %} corr-high-pos
              {% elif val is number and val < -0.7 %} corr-high-neg
              {% endif %}">{{ val }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  {% endif %}

  <!-- Audit Log -->
  <section>
    <div class="section-head">
      <span class="section-hed">Audit Log</span>
      <span class="section-rule"></span>
      <span class="section-count">{{ audit_log | length }} entries</span>
    </div>
    <div class="log-list">
      <div class="log-head">
        <div class="log-hcell">Time</div>
        <div class="log-hcell">Action · Column</div>
        <div class="log-hcell">Detail</div>
      </div>
      {% for entry in audit_log %}
      <div class="log-entry">
        <div class="log-cell log-ts">{{ entry.get("timestamp", "")[-8:-3] or "—" }}</div>
        <div class="log-cell">
          {% set action = entry.get("action", "") %}
          <span class="log-action
            {% if 'drop' in action or 'remov' in action %}drop
            {% elif 'impute' in action or 'fill' in action %}impute
            {% elif 'outlier' in action %}outlier
            {% elif 'pipeline' in action or 'complete' in action or 'started' in action %}pipeline
            {% elif 'id_column' in action %}id
            {% endif %}">{{ action.replace("_", " ") }}</span>
          {% if entry.get("column") %}<span class="log-col">{{ entry.get("column") }}</span>{% endif %}
        </div>
        <div class="log-cell log-detail">
          {% for k, v in entry.items() %}
            {% if k not in ["column", "action", "timestamp"] %}
            <span class="kv"><span class="kv-k">{{ k }}:</span><span class="kv-v">{{ v }}</span></span>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

</main>

<footer>
  Generated by <strong>Oxdemi.io</strong> · Raw in. Clean out.
</footer>

</body>
</html>
